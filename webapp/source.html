<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<!--[if IE]>
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
<![endif]-->
<!--[if lt IE 9]>
<script>
(function(a){for(var i in a){document.createElement(a[i])}})(['header', 'footer', 'section', 'article', 'aside', 'time', 'hgroup'])
</script>
<![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Task Wall</title>
<link rel="stylesheet" href="/production.css"/>
<style>
/* loading indicator */
#loading {
	z-index: 1000;
	width: 80px;
	height: 80px;
	position: fixed;
	top: 50%;
	left: 50%;
	margin-top: -40px;
	margin-left: -40px;
	background-color: rgba(0, 0, 0, 0.9);
	background-image: url('/img/loading2.gif');
	background-repeat: no-repeat;
	background-position: center;
	border-radius: 10px;
	-moz-border-radius: 10px;
}
</style>
</head>
<body>
<div id="loading"></div>
<div id="global-errors" style="display: none;"></div>

<article class="oauth2state unauthorized" style="display: none;">
	<div class="container">
		<h1>Task Wall</h1>
		<div class="lead">成果は日々の積み重ねから</div>
		<div class="row">
		<div class="span8">
		<p>
		Task WallはGoogleタスクと連携するタスク管理アプリです。<br/>
		壁に付箋を貼る感覚でタスクを管理できます。
		</p>
		<div><img src="/img/todo.png" alt="icon" width="128" height="128" /></div>
		</div>
		<div class="span4">
		<div class="well">
		<p>Google アカウントがあればすぐに使えます</p>
		<div><a class="login btn">Google アカウントでログイン</a></div>
		</div>
		<div class="well">
		<div><a href="/?demo">デモを使ってみる</a></div>
		</div>
		</div>
	</div>
	<footer>&copy; hidetake.org, 2011-2012.</footer>
	</div>
</article>

<article class="oauth2state authorizing" style="display: none;">
	<h1>Task Wall<span style="color: gold;">*</span></h1>
	<p>Google APIと通信しています...</p>
</article>

<article class="oauth2state authorized" style="display: none;">
<section class="cache-status">
	<!-- ko with: lastCached -->
	最後の読み込みは
	<span data-bind="text: getMonth()+1"></span>月
	<span data-bind="text: getDate()"></span>日
	<span data-bind="text: getHours()"></span>時
	<span data-bind="text: getMinutes()"></span>分です。
	<!-- /ko -->
</section>

<div class="navbar navbar-fixed-top">
<div class="navbar-inner">
<div class="container">
	<a class="brand" href="/">Task Wall</a>
	<ul class="nav nav-tabs">
	<li data-bind="css: {active: viewModeIs('#overview', '')}">
	<a href="#overview">概況</a>
	</li>
	<li data-bind="css: {active: viewModeIs('#daily')}">
	<a href="#daily">今週の計画</a>
	</li>
	<li data-bind="css: {active: viewModeIs('#weekly')}">
	<a href="#weekly">今月の計画</a>
	</li>
	<li data-bind="css: {active: viewModeIs('#monthly')}">
	<a href="#monthly">今年の計画</a>
	</li>
	<li data-bind="css: {active: viewModeIs('#past')}">
	<a href="#past">過去のタスク</a>
	</li>
	</ul>
	<ul class="nav pull-right">
	<li class="dropdown">
	<a href="#" class="dropdown-toggle" data-toggle="dropdown">タスクリスト <b class="caret"></b></a>
	<ul class="dropdown-menu">
		<!-- ko foreach: tasklists -->
		<li><a data-bind="text: title,
			attr: {'data-tasklistcolor': colorCode},
			click: $root.updateTasklistDialog.create"
			class="tasklist" href="#"></a></li>
		<!-- /ko -->
		<li class="divider"></li>
		<li><a data-bind="click: createTasklistDialog.create" href="#">新しいタスクリスト</a></li>
	</ul>
	</li>
	<li class="dropdown">
	<a href="#" class="dropdown-toggle" data-toggle="dropdown">設定 <b class="caret"></b></a>
	<ul class="dropdown-menu">
		<li><label class="checkbox"><input data-bind="checked: offline" type="checkbox"/>オフライン</label></li>
		<li class="divider"></li>
		<li><a data-bind="click: logout" href="#">ログアウト</a></li>
	</ul>
	</li>
	</ul>
</div>
</div>
</div>

<!-- ko if: viewModeIs('#overview', '') -->
<!-- ko with: overview -->
<section class="overview board nav-tabs-content container">
	<div data-bind="template: {name: 'expired-tasks-template'}"></div>
	<h2>今週</h2>
	<div>
		<!-- ko with: beginOfThisWeek -->
		<span data-bind="text: getMonth()+1"></span>月
		<span data-bind="text: getDate()"></span>日
		<!-- /ko -->
		〜
		<!-- ko with: endOfThisWeek -->
		<span data-bind="text: getMonth()+1"></span>月
		<span data-bind="text: getDate()"></span>日
		<!-- /ko -->
	</div>
	<div class="row">
	<div class="span5">
		<h3>実施中のタスク <span data-bind="text: workingTasks().length" class="badge"></span></h3>
		<div data-bind="foreach: workingTasksGroups">
		<div class="tasklist">
		<div data-bind="text: tasklist.title" class="title"></div>
		<div data-bind="template: {name: 'task-template', foreach: tasks}, visible: tasklist.visible"></div>
		</div>
		</div>
	</div>
	<div class="span5">
		<h3>完了したタスク <span data-bind="text: completedTasks().length" class="badge"></span></h3>
		<div data-bind="foreach: completedTasksGroups">
		<div class="tasklist">
		<div data-bind="text: tasklist.title" class="title"></div>
		<div data-bind="template: {name: 'task-template', foreach: tasks}, visible: tasklist.visible"></div>
		</div>
		</div>
	</div>
	</div>
</section>
<!-- /ko -->
<!-- /ko -->

<!-- ko if: viewModeIs('#daily') -->
<!-- ko with: dailyCalendar -->
<section class="daily board nav-tabs-content margin-for-icebox">
	<div data-bind="template: {name: 'expired-tasks-template'}"></div>
	<table class="calendar">
	<tbody data-bind="foreach: rows">
	<tr data-bind="droppable: {
			accept: '.task',
			hoverClass: 'dropping'
		},
		css: {
			past: past,
			thisweek: thisweek
		}, attr: {
			'data-day': day.getDate(),
			'data-weekday': day.getDay()
		}">
	<td class="month"><div><span data-bind="text: day.getMonth()+1"></span>月</div></td>
	<td class="border day"><div data-bind="text: day.getDate()"></div></td>
	<td class="border weekday"><div data-bind="text: weekdayName"></div></td>
	<td class="border tasks">
		<div data-bind="foreach: tasklists">
		<div data-bind="template: {name: 'task-template', foreach: tasks}, visible: tasklist.visible"
			class="tasklist">
		</div>
		</div>
		<div class="create">
		<a data-bind="click: $root.createTaskDialog.create"
			href="#" class="showtooltip"
			title="新しいタスクを作成する"></a>
		</div>
	</td>
	</tr>
	</tbody>
	</table>
</section>
<!-- /ko -->
<!-- /ko -->

<!-- ko if: viewModeIs('#weekly') -->
<!-- ko with: weeklyCalendar -->
<section class="weekly board nav-tabs-content margin-for-icebox">
	<table class="calendar">
	<tbody data-bind="foreach: rows">
	<tr data-bind="droppable: {
			accept: '.task',
			hoverClass: 'dropping'
		},
		css: {
			thisweek: thisweek
		}">
	<td class="month"><div><span data-bind="text: day.getMonth()+1"></span>月</div></td>
	<td class="border day"><div data-bind="text: day.getDate()"></div></td>
	<td class="border weekday">週</td>
	<td class="border tasks">
		<div data-bind="foreach: tasklists">
		<div data-bind="template: {name: 'task-template', foreach: tasks}, visible: tasklist.visible"
			class="tasklist">
		</div>
		</div>
		<div class="create">
		<a data-bind="click: $root.createTaskDialog.create"
			href="#" class="showtooltip"
			title="新しいタスクを作成する"></a>
		</div>
	</td>
	</tr>
	</tbody>
	</table>
</section>
<!-- /ko -->
<!-- /ko -->

<!-- ko if: viewModeIs('#monthly') -->
<!-- ko with: monthlyCalendar -->
<section class="monthly board nav-tabs-content margin-for-icebox">
	<table class="calendar">
	<tbody data-bind="foreach: rows">
	<tr data-bind="droppable: {
			accept: '.task',
			hoverClass: 'dropping'
		},
		css: {
			thisweek: thisweek
		}">
	<td class="month"><div><span data-bind="text: day.getFullYear()"></span>年</div></td>
	<td class="border day"><div><span data-bind="text: day.getMonth()+1"></span></div></td>
	<td class="border weekday">月</td>
	<td class="border tasks">
		<div data-bind="foreach: tasklists">
		<div data-bind="template: {name: 'task-template', foreach: tasks}, visible: tasklist.visible"
			class="tasklist">
		</div>
		</div>
		<div class="create">
		<a data-bind="click: $root.createTaskDialog.create"
			href="#" class="showtooltip"
			title="新しいタスクを作成する"></a>
		</div>
	</td>
	</tr>
	</tbody>
	</table>
</section>
<!-- /ko -->
<!-- /ko -->

<!-- ko if: viewModeIs('#past') -->
<!-- ko with: pastTasks -->
<section class="past board nav-tabs-content container">
	<div data-bind="foreach: tasklists">
	<div class="tasklist">
	<div class="count"><span data-bind="text: tasks.length" class="badge"></span></div>
	<div data-bind="template: {name: 'task-template', foreach: tasks}, visible: tasklist.visible"></div>
	</div>
	</div>
	<div style="clear: both;"></div>
</section>
<!-- /ko -->
<!-- /ko -->

<!-- ko if: viewModeIs('#daily', '#weekly', '#monthly') -->
<!-- ko with: iceboxTasks -->
<section data-bind="droppable: {
		accept: '.task',
		hoverClass: 'dropping',
		context: $data
	}"
	class="icebox">
	<a data-bind="click: $root.createTaskDialog.create"
		href="#" class="create showtooltip" data-placement="left"
		title="新しいタスクを作成する"></a>
	<h2>未計画のタスク</h2>
	<div data-bind="foreach: tasklists">
	<div class="tasklist-header">
	<span data-bind="text: tasks.length" class="badge"></span>
	</div>
	<div data-bind="template: {name: 'task-template', foreach: tasks}, visible: tasklist.visible"
		class="tasklist">
	</div>
	</div>
</section>
<!-- /ko -->
<!-- /ko -->

<script type="text/html" id="expired-tasks-template">
	<!-- ko with: $root -->
	<!-- ko if: expiredTasksGroups().length > 0 -->
	<div class="expired alert">
		<h4>期限切れのタスクをリスケしてください</h4>
		<div data-bind="foreach: $root.expiredTasksGroups" class="tasklists">
		<div class="tasklist">
		<div data-bind="template: {name: 'task-template', foreach: tasks}, visible: tasklist.visible"></div>
		</div>
		<div style="clear: both;"></div>
		</div>
		<div class="move"><a data-bind="click: moveExpiredTasks" href="#">
			<i class="icon-arrow-down"></i>今週のタスクに移動する
		</a></div>
	</div>
	<!-- /ko -->
	<!-- /ko -->
</script>

<script type="text/html" id="task-template">
<div data-bind="draggableByClone: {},
	click: $root.updateTaskDialog.create,
	event: {dropped: dropped},
	attr: {
		'data-status': status,
		'data-tasklistcolor': tasklist().colorCode
	},
	css: {
		past: past
	}"
	class="task">
<input data-bind="checked: isCompleted, click: saveStatus, clickBubble: false" type="checkbox" />
<span data-bind="text: title" class="title"></span>
<div data-bind="autolinkText: notes" class="notes"></div>
</div>
</script>

<section class="dialogs">
<!-- ko if: createTasklistDialog -->
<!-- ko with: createTasklistDialog -->
<form data-bind="submit: save, escKeydown: dispose">
	<div class="create-tasklist dialog">
	<div><input data-bind="value: title, hasfocus: true" type="text" placeholder="タスクリストの名前" /></div>
	<div><button type="submit" class="btn">タスクリストを作成</button></div>
	</div>
</form>
<div data-bind="click: dispose" class="dialog-background"></div>
<!-- /ko -->
<!-- /ko -->

<!-- ko if: updateTasklistDialog -->
<!-- ko with: updateTasklistDialog -->
<div data-bind="style: {top: top}" class="update-tasklist dialog">
	<form data-bind="submit: saveTitle, escKeydown: dispose">
	<input data-bind="value: title" type="text" placeholder="タスクリストの名前" />
	</form>

	<div data-bind="foreach: colors">
	<div data-bind="css: {selected: $data==$parent.selectedColor()}" class="color">
	<div data-bind="attr: {'data-tasklistcolor': $data}, click: $parent.selectColor"></div>
	</div>
	</div>
	<div style="clear: both;"></div>
	<hr/>

	<a data-bind="visible: !removeConfirmed(), click: confirmRemove" href="#">タスクリストを削除する...</a>
	<div data-bind="visible: removeConfirmed">
	<p><strong>警告:</strong> タスクリストに含まれるすべてのタスクも削除されます。</p>
	<button data-bind="click: remove" class="btn btn-danger">タスクリストを削除する</button>
	</div>
</div>
<div data-bind="click: dispose" class="dialog-background"></div>
<!-- /ko -->
<!-- /ko -->

<!-- ko if: createTaskDialog -->
<!-- ko with: createTaskDialog -->
<form data-bind="submit: save, escKeydown: dispose">
<div data-bind="style: {top: top}" class="create-task dialog">
	<div data-bind="with: due" class="due">
	<span data-bind="text: getFullYear()"></span>年
	<span data-bind="text: getMonth()+1"></span>月
	<span data-bind="text: getDate()"></span>日
	</div>
	<div><input data-bind="value: title, hasfocus: titleFocus" type="text" placeholder="タスクの件名" /></div>
	<div><textarea data-bind="value: notes" placeholder="備考"></textarea></div>
	<div data-bind="foreach: tasklists" class="tasklists">
	<a data-bind="text: title,
		attr: {'data-tasklistcolor': colorCode},
		css: {selected: $data == $parent.selectedTasklist()},
		click: $parent.selectTasklist"
		href="#" class="tasklist"></a>
	</div>
	<button type="submit" class="btn">タスクを作成</button>
	</div>
</form>
<div data-bind="click: dispose" class="dialog-background"></div>
<!-- /ko -->
<!-- /ko -->

<!-- ko if: updateTaskDialog -->
<!-- ko with: updateTaskDialog -->
<div data-bind="style: {top: top}" class="update-task dialog">
<form data-bind="submit: save, escKeydown: dispose">
	<div><input data-bind="value: title, hasfocus: true" type="text" placeholder="タスクの件名" /></div>
	<div><textarea data-bind="value: notes" placeholder="備考"></textarea></div>
	<div data-bind="with: due" class="due">
	<span data-bind="text: getFullYear()"></span>年
	<span data-bind="text: getMonth()+1"></span>月
	<span data-bind="text: getDate()"></span>日
	<a href="#">期限を変更する...</a>
	</div>
	<div class="datepicker"><!-- TODO: bind this --></div>
	<button type="submit" class="btn">タスクを更新</button>
	</form>
	<hr/>

	<form data-bind="submit: move, escKeydown: dispose">
	<div data-bind="foreach: tasklists" class="tasklists">
	<a data-bind="text: title,
		attr: {'data-tasklistcolor': colorCode},
		css: {selected: $data == $parent.selectedTasklist()},
		click: $parent.selectTasklist"
		href="#" class="tasklist"></a>
	</div>
	<button data-bind="disable: selectedTasklist() == originalTasklist()" type="submit" class="btn">
	別のタスクリストに移動
	</button>
	</form>
	<hr/>

	<!-- ko ifnot: removeConfirmed -->
	<a data-bind="click: confirmRemove" href="#">タスクを削除する...</a>
	<!-- /ko -->
	<!-- ko if: removeConfirmed -->
	<button data-bind="click: remove" class="btn btn-danger">タスクを削除する</button>
	<!-- /ko -->
</div>
<div data-bind="click: dispose" class="dialog-background"></div>
<!-- /ko -->
<!-- /ko -->

</section>
</article>

<div id="resources" style="display: none;">
	<div data-key="global-errors">エラーです。もう一度試してみてください。</div>
	<div data-key="weekday0">日</div>
	<div data-key="weekday1">月</div>
	<div data-key="weekday2">火</div>
	<div data-key="weekday3">水</div>
	<div data-key="weekday4">木</div>
	<div data-key="weekday5">金</div>
	<div data-key="weekday6">土</div>
</div>

<script>
/* load assets */
if (location.hostname != 'localhost') {
	var e = document.createElement('script');
	e.src = '/production.js';
	var s0 = document.getElementsByTagName('script')[0];
	s0.parentNode.insertBefore(e, s0);
} else {
	/* use document write method to load scripts sequentially */
	document.write('<script src=\"/assets/\"><\/script>');
}

/* analytics */
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3232369-8']);
  _gaq.push(['_trackPageview']);

  location.hostname == 'localhost' ? null :  /* added */
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>